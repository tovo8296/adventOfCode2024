package day08

import util.Coord

fun main() {
    val world = input.lines().map { it.toList() }
    val antennas = findAntennas(world)
    val antinodes = antennas.values.map { findAntinodes(it, world) }.flatten().toSet()
    println("Antinodes: ${antinodes.size}")
}

fun findAntinodes(antennas: List<Coord>, world: List<List<Char>>): List<Coord> {
    val pairs = calcAntennaPair(antennas)
    val antiNodes = mutableListOf<Coord>()
    pairs.forEach { pair ->
        val dx = pair.first.x - pair.second.x
        val dy = pair.first.y - pair.second.y
        antiNodes.add(Coord(pair.first.x + dx, pair.first.y + dy))
        antiNodes.add(Coord(pair.second.x - dx, pair.second.y - dy))
    }
    return antiNodes.filter { it.isValid(world) }
}


fun calcAntennaPair(antennas: List<Coord>): List<Pair<Coord, Coord>> {
    val pairs = mutableListOf<Pair<Coord, Coord>>()
    antennas.forEachIndexed { index, coord ->
        antennas.drop(index+1).forEachIndexed { index2, coord2 ->
            pairs.add(coord to coord2)
        }
    }
    return pairs
}

fun findAntennas(world: List<List<Char>>): Map<Char, MutableList<Coord>> {
    val antennas = mutableMapOf<Char, MutableList<Coord>>()
    world.forEachIndexed { y, line ->
        line.forEachIndexed { x, c ->
            if (c != '.') {
                val coords = antennas.getOrPut(c) {mutableListOf()}
                coords.add(Coord(x, y))
            }
        }
    }
    return antennas
}

val test = """
............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............
""".trimIndent()

val input = """
..................................w...............
..................................................
.....................................C............
......................................3...........
.............b.......u.........w...........3......
...........................u......................
...8........K...........u.......y.........I.......
..................................P5........B.....
...U................2.P...............B...C.......
............i......x.P........w......s.C......IB5.
..............t....................y....x.........
.......8............K....1.......w............u...
.................i.............r.........s........
..2.............t..T.K.......r......8..........I..
8..............t..T.....r...................5.....
...2........................1....M.t...N....x.....
...V....U.......................N.S..........I....
.........W...i............O....v............S.....
................L...1...s.fT.....x............3...
....6.......C...N.........Tf.3....................
...6.......F..........V..........k...N......H.....
...................U..f........0......H.y.........
.......................O...P......0...............
.......L..U....m.......R............s.............
6...i.................O....0.2.........H.....B....
........................R......H.........S........
......F.....c..........m..............d...........
................F.L.....m..................7......
.............J.........................S..........
.b....j.k..............V0.........................
.................L.....K..........................
.......F.......J..............r.....M.............
......................m1....a.R...7...............
.......4......Y..6.D..............................
k............9.......D................M...........
.....Xb.................V...h.....................
A.........9.Xl..........D......R..................
4.............c..d........D.............7.........
.A.4.............c.............M.7.v..............
..........n.9........................h............
...j....bd.........f.....p..W.....................
.............k.........p..........................
.......W4.......p......X.....5..J.....v...........
........W.d..c......A........n..v.....o...........
..........l.....n..........o......Y...h...........
.....A............................................
..j..........n....................................
a9.lX..................Y...........o..............
.......a.................Y..........o.............
...a....l.......................p.................
""".trimIndent()